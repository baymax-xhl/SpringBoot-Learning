# rabbitmq

## 分布式事务

[利用RabbitMQ实现分布式事务](https://www.cnblogs.com/hhhshct/p/11496536.html)

[RabbitMQ解决分布式事务](https://www.cnblogs.com/toov5/p/10289999.html)

[基于RabbitMQ消息队列的分布式事务解决方案 - MQ分布式消息中间件实战](https://developer.aliyun.com/article/726508)

1、确认生产者一定要将数据投递到MQ服务器中（采用MQ消息确认机制）
2、MQ消费者消息能够正确消费消息，采用手动ACK模式，使用不补偿机制（注意重试幂等性问题）
3、如何保证第一个事务先执行，采用补偿机制（补单机制），在创建一个补单消费者进行监听，如果订单没有创建成功，进行补单


1) 场景1 如果消费者消费消息失败了 

 生产者是不需要回滚事务。 消费者采用手动ack应答方式  进行补偿机制，补偿的过程中注意 幂等性 问题。

 分布式事务中遵循base理论 遵循cpa理论

 如何确保生产者发送消息一定发送到MQ消息服务器端成功？ confirm机制 确认应答机制

2) 场景2 如果生产者发送消息到MQ服务器端失败 

   使用生产者重试机制进行发消息

3) 场景3 如何保证第一个事务先执行,生产者投递消息到MQ服务器成功，消费者消费消息成功了，但是订单事务回滚了
    （生产者投递消息给消费者消费成功 然后 生产者回滚了）  